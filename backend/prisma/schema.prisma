generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  STUDENT
  ADMIN
  STAFF
}

enum BranchType {
  AIML
  ECE
  CSE
  EEE
  ISE
  MECH
}

enum SemesterType {
  S1
  S2
  S3
  S4
  S5
  S6
  S7
  S8
}

model User {
  id           String      @id @default(uuid())
  email        String      @unique
  password     String
  name         String?
  usn          String? @unique
  section      String? 
  schema       String?
  branch       BranchType? @default(AIML)
  semester     SemesterType? @default(S1)
  role         Role        @default(STUDENT)
  isVerified   Boolean     @default(false)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  // group the users basedon the branch and semester
  @@index([branch, semester,section]) // Index for faster queries based on branch and semester
  Attendance Attendance[]
}

model Branch {
  name       BranchType @id
  Semesters  Semester[]
}

model Semester {
  id           String        @id @default(uuid())
  branchName   BranchType
  number       SemesterType
  branch       Branch         @relation(fields: [branchName], references: [name])
  Timetables   TimetableOfDay[]
  Subjects      Subject[]
  @@unique([branchName, number]) 
}

model Subject {
  id           String        @id @default(uuid())
  subjectName         String
  subjectCode        String
  branchName   BranchType
  noOfCredits   Int
  semesterNumber SemesterType
  semester     Semester      @relation(fields: [branchName, semesterNumber], references: [branchName, number])
  staffName        String
  isLab        Boolean       @default(false)

  @@unique([branchName, semesterNumber, subjectCode]) 
}

model TimetableOfDay {
  id               String           @id @default(uuid())
  date             DateTime
  branchName       BranchType
  semesterNumber   SemesterType
  semester         Semester         @relation(fields: [branchName, semesterNumber], references: [branchName, number])
  Periods          Period[]

  @@unique([date, branchName, semesterNumber]) // Ensure one timetable per day for each branch and semester
}

model Period {
  id           String           @id @default(uuid())
  timetableId  String
  periodNumber Int @default(autoincrement())
  timetable    TimetableOfDay   @relation(fields: [timetableId], references: [id],onDelete: Cascade)
  startTime    DateTime
  endTime      DateTime
  subject      String
  staff        String
  subjectCode  String
  whatlearned  String?
  // attendence here 
  isLab        Boolean          @default(false)

  @@unique([timetableId, periodNumber]) // Ensure no duplicate period numbers
  Attendance Attendance[]
}

model Attendance {
  id           String      @id @default(uuid())
  userId       String
  periodId     String
  date         DateTime
  name  String?
  usn  String?
  status       AttendanceStatus @default(NOT_TAKEN)

  user         User        @relation(fields: [userId], references: [id],onDelete: Cascade)
  period       Period      @relation(fields: [periodId], references: [id] , onDelete: Cascade)

  @@unique([userId, periodId]) // Ensure no duplicate attendance for the same student in the same period
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  NOT_TAKEN
}


model OtpVerification {
  id           String      @id @default(uuid())
  email        String      @unique
  otp          Int
  otpExpiresAt DateTime
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}